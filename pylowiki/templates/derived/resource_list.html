<%!
    from pylowiki.lib.db.user import getUserByID, isAdmin
    from pylowiki.lib.db.facilitator import isFacilitator
    import pylowiki.lib.helpers as h
    from pylowiki.lib.fuzzyTime import timeSince
%>

<%inherit file = "/base/template.html"/>
<%namespace file="/lib/mako_lib.mako" import="return_to" />

${return_to()}

<div class="left headline banner_div">
    <h2 class="banner"><a href = "/workshop/${c.w['urlCode']}/${c.w['url']}">${c.w['title']}</a></h2> 
    <br/>
</div> <!-- left headline -->

<div id="suggestion_main" class="left clr">
    <h3>Disabled Reources</h3>
    % if c.darticles == None or len(c.darticles) == 0:
        <span class="colhd">No resources!</span>
    % else:
        <% counter = 1 %>
            <div id="suggestion_main" class="left clr">
            % for item in c.darticles:
                <br /><br />
                <% author = getUserByID(item.owner) %>
                <span class="colhd"><a href="/workshop/${c.w['urlCode']}/${c.w['url']}/resource/${item['urlCode']}/${item['url']}">${item['title']}</a></span>
                <br />
                <p class="clr">
                <% rContent = h.literal(h.reST2HTML(item['comment'])) %>
                % if len(rContent) < 50:
                    ${rContent}
                % else:
                    ${rContent[:50]}...
                    <span class="right"><a href="/workshop/${c.w['urlCode']}/${c.w['url']}/resource/${item['urlCode']}/${item['url']}">more</a></span>
                % endif
                </p>
                <div class="clr">
                % if isAdmin(author.id):
                        <% uTitle = ' (Admin)' %>
                % elif isFacilitator(author.id, c.w.id):
                        <% uTitle = ' (Facilitator)' %>
                % else:
                        <% uTitle = '' %>
                % endif
                <span class="gray">Posted by <a href="/profile/${author['urlCode']}/${author['url']}">${author['name']}</a>${uTitle}</span><br /><span class="time">${timeSince(item.date)}</span> <span class="gray">ago</span>
                </div>
                <br /><br />
            % endfor
            </div>
    % endif
</div> <!-- suggestion_main -->
        	
<div id="suggestion_side" class="left">
    <h3>Other Resources</h3>
    <ul id="related_suggestion">
    % if not c.suggestions or len(c.suggestions) == 0:
        <li>
        No other suggestions!
        </li>
    % else:
        % for suggestion in c.suggestions:
            <% author = getUserByID(suggestion.owner)%>
            <li>
            <strong class="issue_name"><a href="/workshop/${c.w['urlCode']}/${c.w['url']}/suggestion/${suggestion['urlCode']}/${suggestion['url']}">${suggestion['title']}</a></strong>
            <br />
            <span class="gray">By <a href="/profile/${author['urlCode']}/${author['url']}">${author['name']}</a></span>
            </li>
        % endfor
    % endif
    </ul> <!-- related_suggestion -->
    <ul class="share suggest invite">
        <li><img src="/images/handdove.png" /> <a href="#">Invite to Civinomics</a></li>
        <li><img src="/images/suggest_an_issue.png" /> <a href="#">Suggest a workshop</a></li>
    </ul>
</div>

<%def name = 'extraHTML()'>
</%def>

<%def name = 'extraStyles()'>
    <link type="text/css" rel="stylesheet" href="/styles/suggestion.css" />
    <link type="text/css" rel="stylesheet" href="/js/markitup/sets/rst/style.css" />
</%def>

<%def name = 'extraScripts()'>
    <script src = "/js/h2banner.js" type="text/javascript"></script>
    <script src = "/js/javascript.js" type="text/javascript"></script>
    <script src = "/js/jquery-ui-1.8.18.custom.min.js" type="text/javascript"></script>
</%def>
