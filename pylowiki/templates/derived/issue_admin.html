<%inherit file = "/base/template.html"/>
<%!
    from pylowiki.lib.db.flag import checkFlagged
    from pylowiki.lib.db.comment import getFlaggedDiscussionComments
    from pylowiki.lib.db.article import getFlaggedArticlesByWorkshopID, getArticleByID
%>  

    <div class="banner_div">
        <h2 class="banner"><a href = "/workshop/${c.w['urlCode']}/${c.w['url']}">${c.title}</a></h2>
    </div>     
    <br /><br />
    <br /><br />

<form name="admin_issue" id="admin_issue" class="left" action = "/workshop/${c.w['urlCode']}/${c.w['url']}/adminWorkshopHandler" enctype="multipart/form-data" method="post" >

    <p>
    <strong class="gray">Administrate Workshop</strong>
    <br /><br />
    Message to Participants:
    <br />
    <textarea name="motd" rows="5" cols="50">${c.motd['data']}</textarea>
    <br /><br />
    % if c.motd['enabled'] == '1':
       <% pChecked = 'checked' %>
       <% uChecked = '' %>
    % else:
       <% pChecked = '' %>
       <% uChecked = 'checked' %>
    % endif
    <input type=radio name="enableMOTD" value="1" ${pChecked}> Publish&nbsp;&nbsp;&nbsp;<input type=radio name="enableMOTD" value="0" ${uChecked}> Unpublish
    <br /><br />
    <br /><br />
    % if c.w['deleted'] == '1':
       Enable Workshop
       <% eAction = 'Enable' %>
    % else:
       Disable Workshop
       <% eAction = 'Disable' %>
    % endif
    <br />
    <input type=radio name="enableWorkshop" value="1"> ${eAction}&nbsp;&nbsp;&nbsp;<input type=radio name="verifyEnableWorkshop" value="0"> Verify ${eAction}
    <br /><br />
    <br /><br />
    <button type="submit" class="gold">Save Changes</button>

    <br /><br />
    <br /><br />
    <% sFlagCount = 0 %>
    <% cFlagCount = 0 %>
    <% rFlagCount = 0 %>
    <% rList = getFlaggedArticlesByWorkshopID(c.w.id) %>
    % if rList:
       % for rID in rList:
          <% a = getArticleByID(rID) %>
          % if a and checkFlagged(a): 
             <% rFlagCount += 1 %>
          % endif
       % endfor
    % endif
    % for s in c.s:
       % if checkFlagged(s): 
          <% sFlagCount += 1 %>
       % endif
       <% cList = getFlaggedDiscussionComments(s['discussion_id']) %>
       % if cList:
          <% cFlagCount += len(cList) %>
       % endif
    % endfor
    <strong class="gray">Flagged Objects</strong>
    <br /><br />
    <ul>
    <li>Suggestions: ${sFlagCount}</li>
    <li>Comments:  ${cFlagCount}</li>
    <li>Resources:  ${rFlagCount}</li>
    </ul> 

</form>

            
<%def name = 'extraHTML()'>

</%def>
            
<%def name = 'extraStyles()'>
    <link type="text/css" rel="stylesheet" href="${h.url_for('/styles/issue_create.css')}" />
    <link type="text/css" rel="stylesheet" href="${h.url_for('/js/markitup/skins/simple/style.css')}" />
    <link type="text/css" rel="stylesheet" href="${h.url_for('/js/markitup/sets/rst/style.css')}" />
    <link type="text/css" rel="stylesheet" href="${h.url_for('/css/pygments/pygments-tango.css')}" />
</%def>

<%def name = 'extraScripts()'>
    <script src="${h.url_for('/js/h2banner.js')}" type="text/javascript"></script>
    <script src = "${h.url_for('/js/markitup/jquery.markitup.js')}" type="text/javascript"></script>
    <script src = "${h.url_for('/js/markitup/sets/rst/set.js')}" type="text/javascript"></script>
    <script src = "${h.url_for('/js/javascript.js')}" type="text/javascript"></script>
    
    <script language="javascript">
        $(document).ready(function()	{
            $(".markitup").markItUp(mySettings);
        });
    </script>
    
</%def>
